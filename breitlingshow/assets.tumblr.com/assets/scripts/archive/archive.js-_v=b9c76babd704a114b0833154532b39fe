(typeof Tumblr!=="undefined")||(Tumblr={});
/*!
 * Tumblr.Dialog
 * A highly customizable queuing dialog system with easy replacements for alert() and prompt()
 * Features:
 *   - Add custom templates
 *   - Tab between buttons + enter/escape support
 *   - Default buttons tied to keys
 *   - Multiple dialogs queue for user
 *   - Multiple button styles
 *   - Callbacks everywhere
 */
(function(c,b){var a=Backbone.View.extend({el:".ui_dialog",translations:{},defaults:{},default_templates:{dialog:'<div class="ui_dialog <%= type %>"><%= content_html %><div class="buttons"><%= buttons_html %></div></div>',content:'<span class="text"><%= text %></span>',button:'<button class="ui_button btn_<%= btn_id %> chrome <%= btn_class %>" data-btn-id="<%= btn_id %>"><span><%= text %></span></button>'},events:{"click .ui_button":"button_click"},default_dialog:{text:"",type:"default",has_form:"auto",visible_glass:true,confirm_by_enter:true,close_by_space:true,key_tab:true,key_close:true,animate:true,animate_in:{dialog_el:".ui_dialog",dialog_class:"add_animation fadeIn"},on_close:function(){},on_open:function(){}},initialize:function(d){this.options=_.extend(this.defaults,this.options);this.templates=this.default_templates;this.is_visible=false;this.dialog_queue_order=[];this.dialog_queue={};this.queue_counter=0;this.current_dialog=false;this.current_dialog_id=0;this.uid=0;this._init_click_lock();this._setup_keys()},add_translations:function(d){jQuery.extend(this.translations,d)},unset_translations:function(){this.translations={}},__:function(d){return this.translations[d]||d},dialog:function(d){if(!_.isObject(d)){return false}return this._dialog(d)},confirm:function(e,i,j,g,d){if(_.isString(e)){e={text:e}}var h={callback_ok:i,callback_cancel:j,text_ok:g,text_cancel:d};e=_.extend({},h,e);var f={text:e.text,type:"confirm",visible_glass:true,templates:e.templates||null,escape_button:0,buttons:{0:{text:e.text_cancel||this.__("Cancel"),close:true,callback:((_.isFunction(e.callback_cancel))?e.callback_cancel:function(){})},1:{text:e.text_ok||this.__("OK"),selected:true,btn_class:"blue",close:true,callback:((_.isFunction(e.callback_ok))?e.callback_ok:function(){})}}};return this._dialog(f)},alert:function(d,h,f){if(_.isString(d)){d={text:d}}var g={callback_ok:h,text_ok:f};d=_.extend({},g,d);var e={text:d.text,type:"alert",visible_glass:true,templates:d.templates||null,escape_button:0,buttons:{0:{text:d.text_ok||this.__("OK"),selected:true,btn_class:"blue",close:true,callback:((_.isFunction(d.callback_ok))?d.callback_ok:function(){})}}};return this._dialog(e)},button_click:function(i){var h=c(i.currentTarget);var g=h.data("btn-id");if(_.isUndefined(this.current_dialog.buttons[g])){return false}var f=this.current_dialog.buttons[g];var d=null;if(_.isFunction(f.callback)){d=f.callback(this)}if(d!==false&&((!_.isUndefined(f.close)&&f.close)||_.isUndefined(f.close))){this.close()}},is_active:function(d){if((this.current_dialog===false)||(this.current_dialog.uid!=d)){return false}return true},close:function(f){if(this.current_dialog===false){return false}if(_.isUndefined(f)){f=false}if(f!==false&&this.current_dialog.uid!=f){return false}this.$dialog_lock.hide();c(".ui_dialog_pos").remove();this.is_visible=false;if(_.isObject(Tumblr.KeyCommands)){Tumblr.KeyCommands.resume()}if(_.isFunction(this.current_dialog.on_close)){this.current_dialog.on_close()}this.current_dialog=false;if(this.dialog_queue_order.length>0){var d=this.dialog_queue_order.shift();var e=this.dialog_queue[d];delete this.dialog_queue[d];this._dialog(e)}},_tab:function(h){var g=this.$el.find(".buttons .tab_frame");var k=g.filter(".focus");var j=g.index(k);var f=g.length;var d=false;if((j+1)<f){d=j+1}else{d=0}k.removeClass("focus init_focus");var i=g.eq(d);if(i.length>0){i.addClass("focus");i.find("button").focus()}},_form_is_tab_to_button:function(j,h){var k=this.$el.find(":focus");if(k.length===0){return true}var i=this.$el.find(".buttons .tab_frame");var g=this.$el.find(":input:visible");var f=g.index(k);if(h&&(f===(g.length-1))){this.$el.find(":input:visible:first").focus();j.preventDefault();i.removeClass("focus init_focus");return false}if(f>=0){var d=this.$el.find(":input:visible:eq("+(f+1)+")");if((d.length>0)&&d.hasClass("ui_button")){return true}}i.removeClass("focus init_focus");return false},_select:function(g){var f=this.$el.find(".buttons .tab_frame.focus");var d=f;if(d.length===1){d.find(".ui_button").click()}},_form_is_focus_on_button:function(d){var f=this.$el.find(":focus");if(f.length===0){return false}return f.hasClass("ui_button")},_escape:function(d){if(_.isUndefined(this.current_dialog.escape_button)){return}var f=this.$el.find(".btn_"+this.current_dialog.escape_button);if(f.length){f.click()}},_dialog:function(g){if(_.isUndefined(g.uid)){g.uid=this._get_uid()}if(this.current_dialog!==false){this.dialog_queue_order.push(this.queue_counter);this.dialog_queue[this.queue_counter]=g;this.queue_counter++;return g.uid}_.defaults(g,this.default_dialog);var h=this._build_buttons(g.buttons);_.extend(g,{buttons_html:h});var e=this.templates;if(_.isObject(g.templates)){e=_.extend({},this.templates,g.templates)}var d=_.template(e.dialog);var f=_.template(e.content);g.content_html=f(g);var i=d(g);this.$dialog_lock.show();if(!_.isUndefined(g.visible_glass)){if(g.visible_glass){this.$dialog_lock.addClass("opaque")}}else{this.$dialog_lock.removeClass("opaque")}this.current_dialog_id=g.uid;this.current_dialog=g;c("body").append('<div id="dialog_'+this.current_dialog_id+'" class="ui_dialog_pos">'+i+"</div>");this.$el=c("#dialog_"+this.current_dialog_id);this.is_visible=true;if(g.animate&&_.isObject(g.animate_in)&&this.$el.find(g.animate_in.dialog_el).length){this.$el.find(g.animate_in.dialog_el).addClass(g.animate_in.dialog_class)}this._focus();if(_.isObject(Tumblr.KeyCommands)){Tumblr.KeyCommands.suspend()}if(_.isUndefined(g.has_form)){g.has_form="auto"}if(g.has_form==="auto"){g.has_form=(this.$el.find("form, input").length>0)}if(_.isFunction(g.on_open)){g.on_open()}this.el=this.$el[0];this.delegateEvents();return g.uid},_button:function(h,f,i,g){var e=_.template(this.templates.button);if(_.isObject(this.current_dialog.templates)){e=this.current_dialog.templates.button}if(g){f+=" default-pulse"}var d=e({btn_class:f,text:h,btn_id:((!_.isUndefined(i))?i:"")});d='<div class="tab_frame">'+d+"</div>";return d},_focus:function(){if(!this.current_dialog){return false}for(var e in this.current_dialog.buttons){var d=this.current_dialog.buttons[e];if(!_.isUndefined(d.selected)&&d.selected){$button=this.$el.find(".btn_"+e);if($button.length>0){$button.parent().addClass("focus init_focus")}}}},_setup_keys:function(){c(document).on("keydown",_.bind(function(g){var f=(g.ctrlKey||g.shiftKey||g.metaKey);if(!this.is_visible||f){return}var d=g.keyCode||g.which;if((d===9)&&this.current_dialog.key_tab){if(this.current_dialog.has_form){if(!this._form_is_tab_to_button(g,true)){return}}g.preventDefault();this._tab(g)}if(((d===13)&&this.current_dialog.confirm_by_enter)||((d===32)&&this.current_dialog.close_by_space)){if(this.current_dialog.has_form&&(d===32)){if(!this._form_is_focus_on_button(g)){return}}g.preventDefault();this._select(g)}if((d===27)&&this.current_dialog.key_close){g.preventDefault();this._escape(g)}},this))},_build_buttons:function(k){if(!_.isObject(k)){return""}var h=0;for(var g in k){if(k.hasOwnProperty(g)){h++}}var f="";for(var e=0;e<h;e++){if(_.isUndefined(k[e])){continue}var l=(!_.isUndefined(k[e].text))?k[e].text:"";var d=(!_.isUndefined(k[e].btn_class))?k[e].btn_class:"";var j=(!_.isUndefined(k[e].selected))?k[e].selected:false;f+=this._button(l,d,e,j)}return f},_init_click_lock:function(){this.$dialog_lock=false;c(_.bind(function(){c("body").prepend('<div class="ui_dialog_lock"></div>');this.$dialog_lock=c("body > .ui_dialog_lock")},this))},_get_uid:function(){return this.uid++}});b.Dialog=new a()})(jQuery,Tumblr);
(function(e,f,g){var b=f.event,d;b.special.smartresize={setup:function(){f(this).bind("resize",b.special.smartresize.handler)},teardown:function(){f(this).unbind("resize",b.special.smartresize.handler)},handler:function(k,h){var j=this,i=arguments;k.type="smartresize";if(d){clearTimeout(d)}d=setTimeout(function(){a.onBeforeSmartResize();b.dispatch.apply(j,i);a.onAfterSmartResize()},h==="execAsap"?0:100)}};f.fn.smartresize=function(h){return h?this.bind("smartresize",h):this.trigger("smartresize",["execAsap"])};f.Mason=function(h,i){this.element=f(i);this._create(h);this._init()};f.Mason.settings={isResizable:true,isAnimated:false,animationOptions:{queue:false,duration:500},gutterWidth:0,isRTL:false,isFitWidth:false,containerStyle:{position:"relative"}};f.Mason.prototype={_filterFindBricks:function(i){var h=this.options.itemSelector;return !h?i:i.filter(h).add(i.find(h))},_getBricks:function(i){var h=this._filterFindBricks(i).css({position:"absolute"}).addClass("masonry-brick");return h},_create:function(k){this.options=f.extend(true,{},f.Mason.settings,k);this.styleQueue=[];var j=this.element[0].style;this.originalStyle={height:j.height||""};var l=this.options.containerStyle;for(var n in l){this.originalStyle[n]=j[n]||""}this.element.css(l);this.horizontalDirection=this.options.isRTL?"right":"left";var i=this.element.css("padding-"+this.horizontalDirection);var m=this.element.css("padding-top");this.offset={x:i?parseInt(i,10):0,y:m?parseInt(m,10):0};this.isFluid=this.options.columnWidth&&typeof this.options.columnWidth==="function";var h=this;setTimeout(function(){h.element.addClass("masonry")},0);this.ghoster=new a(h);if(this.options.isResizable){f(e).bind("smartresize.masonry",function(){h.resize();h.ghoster.resized()})}this.reloadItems()},_init:function(h){this._getColumns();this._reLayout(h);this.ghoster.updateView()},option:function(h,i){if(f.isPlainObject(h)){this.options=f.extend(true,this.options,h)}},layout:function(p,q){for(var n=0,o=p.length;n<o;n++){this._placeBrick(p[n])}var h={};h.height=Math.max.apply(Math,this.colYs);if(this.options.isFitWidth){var l=0;n=this.cols;while(--n){if(this.colYs[n]!==0){break}l++}h.width=(this.cols-l)*this.columnWidth-this.options.gutterWidth}this.styleQueue.push({$el:this.element,style:h});var j=!this.isLaidOut?"css":(this.options.isAnimated?"animate":"css"),k=this.options.animationOptions;var m;for(n=0,o=this.styleQueue.length;n<o;n++){m=this.styleQueue[n];m.$el[j](m.style,k)}this.ghoster.layout(this.styleQueue);this.ghoster.updateView();this.styleQueue=[];if(q){q.call(p)}this.isLaidOut=true},_getColumns:function(){var h=this.options.isFitWidth?this.element.parent():this.element,i=h.width();this.columnWidth=this.isFluid?this.options.columnWidth(i):this.options.columnWidth||this.ghoster.firstBrickOuterWidth()||i;this.columnWidth+=this.options.gutterWidth;this.cols=Math.floor((i+this.options.gutterWidth)/this.columnWidth);this.cols=Math.max(this.cols,1)},_placeBrick:function(q){var o=f(q),s,w,l,u,m;s=Math.ceil(this.ghoster.outerWidth(o)/this.columnWidth);s=Math.min(s,this.cols);if(s===1){l=this.colYs}else{w=this.cols+1-s;l=[];for(m=0;m<w;m++){u=this.colYs.slice(m,m+s);l[m]=Math.max.apply(Math,u)}}var h=Math.min.apply(Math,l),v=0;for(var n=0,r=l.length;n<r;n++){if(l[n]===h){v=n;break}}var p={top:h+this.offset.y};p[this.horizontalDirection]=this.columnWidth*v+this.offset.x;this.styleQueue.push({$el:o,style:p});var t=h+this.ghoster.outerHeight(o),k=this.cols+1-r;for(n=0;n<k;n++){this.colYs[v+n]=t}},resize:function(){var h=this.cols;this._getColumns();if(this.isFluid||this.cols!==h){this._reLayout()}},_reLayout:function(j){var h=this.cols;this.colYs=[];while(h--){this.colYs.push(0)}this.layout(this.$bricks,j)},reloadItems:function(){this.$bricks=this._getBricks(this.element.children())},reload:function(h){this.reloadItems();this._init(h)},appended:function(i,j,k){if(j){this._filterFindBricks(i).css({top:this.element.height()});var h=this;setTimeout(function(){h._appended(i,k)},1)}else{this._appended(i,k)}},_appended:function(h,j){var i=this._getBricks(h);this.$bricks=this.$bricks.add(i);this.layout(i,j)},remove:function(h){this.$bricks=this.$bricks.not(h);h.remove()},destroy:function(){this.$bricks.removeClass("masonry-brick").each(function(){this.style.position="";this.style.top="";this.style.left=""});var h=this.element[0].style;for(var i in this.originalStyle){h[i]=this.originalStyle[i]}this.element.unbind(".masonry").removeClass("masonry").removeData("masonry");f(e).unbind(".masonry");this.ghoster.destroy()}};var a=f.fn.Ghost=(function(){var k=40;var o=500;var m=500;var l=f(document);var j=f(e);var q={scrollTop:null,documentHeight:null,windowHeight:null,windowWidth:null};var n=(function(){var v=0;var u="ghosted";return function(){return u+v++}}());function t(){var u=document.createElement("script");u.type="text/template";u.id=n();return u}function s(w,u,v){u||(u=250);var x,y;return function(){var B=v||this;var A=+new Date(),z=arguments;if(x&&A<x+u){clearTimeout(y);y=setTimeout(function(){x=A;w.apply(B,z)},u)}else{x=A;w.apply(B,z)}}}j.bind("scroll.ghoster",s(function(){q.scrollTop=j.scrollTop();j.trigger("ghostscroll",[q])},k));function r(u){this.instance=u;this.options=u.options.ghoster||{};q.scrollTop=j.scrollTop();q.documentHeight=l.height();q.windowHeight=j.height();q.windowWidth=j.width();j.on("ghostscroll.ghoster",f.proxy(this.updateView,this))}r.onBeforeSmartResize=function(){q.scrollTop=j.scrollTop();q.documentHeight=l.height();q.windowHeight=j.height();q.windowWidth=j.width();j.trigger("ghostbeforeresize",[q])};r.onAfterSmartResize=function(){j.trigger("ghostafterresize",[q])};r._excluder=function(w,v){v=!!v;if(w instanceof jQuery){w=w.toArray()}else{if(!Array.isArray(w)){w=[w]}}var u=w.length;while(u--){if(!(w[u] instanceof Element)){throw ("exclude takes either jquery object, arary of elements, or element.")}f.data(w[u],"*exclude",v)}};r.exclude=function(u){return r._excluder(u,true)};r.unexclude=function(u){return r._excluder(u,false)};var p="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";function h(v){var u=v.length;var w;while(u--){w=v[u];if(w.nodeName==="IMG"){if(w.src!==p){w.setAttribute("data-src",w.src);w.src=p}}else{if(w.style.backgroundImage){w.style.backgroundImage=""}}}}function i(w){var u=w.length;var x;var v;while(u--){x=w[u];if(x.nodeName==="IMG"){if(x.src===p){x.src=x.getAttribute("data-src")}}else{v=x.getAttribute("data-imageurl");if(x.style.backgroundImage.indexOf(v)===-1){x.style.backgroundImage="url("+v+")"}}}}r._brickBlanker=function(w,u){if(w instanceof Element){u=w;w="blank"}var v=f.data(u,"*blankables");if(v&&v.length){w==="blank"?h(v):i(v);f.data(u,"*blanked",(w==="blank"))}};r._brickUnblanker=function(u){var v=f.data(u,"*blankables");if(v&&v.length){h(v)}};r.live=function(v){var y=f.data(v);var w=y["*attached"];var x=y["*blanked"];var u=y["*detachable"];var z=y["*placeholder"];if(w){return}z.parentNode.replaceChild(u,z);f.data(v,"*attached",true)};r.prototype.resized=function(){this.updateView()};r.prototype.destroy=function(){var u=["*top","*bottom","*parent","*outerHeight","*outerWidth"];this.instance.$bricks.each(function(){var v=this;f.removeData(v,u)});j.unbind(".ghoster");j=null;this.instance=null};r.prototype.updateView=function(){var u=this.instance;var w=q.scrollTop-o;var v=q.scrollTop+q.windowHeight+m;u.$bricks.each(function(){var C=this;var B=f.data(C);var z=B["*attached"];var y=B["*blankable"];var F=B["*blanked"];var H=B["*bottom"];var E=B["*top"];var A=B["*exclude"];var G=B["*detachable"];var D=B["*placeholder"];var x=B["*seen"];if(E<v&&w<H){if(y&&F){i(B["*blankables"]);f.data(C,"*blanked",false)}if(!x){f.data(C,"*seen",true)}if(z){return}D.parentNode.replaceChild(G,D);f.data(C,"*attached",true)}else{if(!x||!z||A){return}if(y&&!F){h(B["*blankables"]);f.data(C,"*blanked",true)}G.parentNode.replaceChild(D,G);f.data(C,"*attached",false)}})};r.prototype.layout=function(G){var C;var z;var K;var E;var J;var B;var A;var v;var F;var M;var x;var y;var H=this.instance.element;var w=H.get(0);var D=f.data(w);var u=D["*top"];if(!u){u=H.offset().top;f.data(w,"*top",u)}var L=this.options.detachable;var I=G.length;while(I--){K=G[I].$el.get(0);if(w===K){continue}M=f.data(K);v=M["*outerHeight"];if(typeof v==="undefined"){throw ("should have outerHeight already")}x=M["*blankable"];E=M["*parent"];A=M["*placeholder"];z=M["*detachable"];if(!E||!A||!z||x===g){y=f.makeArray(K.querySelectorAll("[data-imageurl], img"));z=L?K.querySelector(L):K;A=t();E=K.parentNode;f.data(K,"*blankable",!!y.length);f.data(K,"*blanked",!!y.length);f.data(K,"*blankables",y.length?y:null);f.data(K,"*attached",true);f.data(K,"*seen",false);f.data(K,"*detachable",z);f.data(K,"*parent",E);f.data(K,"*placeholder",A)}F=u+parseInt(K.style.top,10);C=F+v;f.data(K,"*bottom",C);f.data(K,"*top",F)}};r.prototype.firstBrickOuterWidth=function(){var v=this.instance.$bricks.get(0);var u=this.instance.$bricks.eq(0);return f.data(v,"*outerWidth")||u.outerWidth(true)};r.prototype.recalc=function(v){var u=this;var w=v.get(0);var y=f.data(w);var x=v.outerHeight(true);var z=v.outerWidth(true);if(y["*outerHeight"]!==x||y["*outerWidth"]!==z){f.data(w,"*outerHeight",x);f.data(w,"*outerWidth",z);u._reLayout()}return this};r.prototype.outerWidth=function(u){var v=u.get(0);var w=f.data(v,"*outerWidth");if(!w){w=u.outerWidth(true);f.data(v,"*outerWidth",w)}return w};r.prototype.outerHeight=function(u){var v=u.get(0);var w=f.data(v,"*outerHeight");if(!w){w=u.outerHeight(true);f.data(v,"*outerHeight",w)}return w};return r}());
/*!
   * jQuery imagesLoaded plugin v1.1.0
   * http://github.com/desandro/imagesloaded
   *
   * MIT License. by Paul Irish et al.
   */
f.fn.imagesLoaded=function(o){var m=this,k=m.find("img").add(m.filter("img")),h=k.length,n="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",j=[];function l(){o.call(m,k)}function i(q){var p=q.target;if(p.src!==n&&f.inArray(p,j)===-1){j.push(p);if(--h<=0){setTimeout(l);k.unbind(".imagesLoaded",i)}}}if(!h){l()}k.bind("load.imagesLoaded error.imagesLoaded",i).each(function(){var p=this.src;this.src=n;this.src=p});return m};var c=function(h){if(e.console){e.console.error(h)}};f.fn.ghost=function(i){if(typeof i==="string"){var h=Array.prototype.slice.call(arguments,1);this.each(function(){var j=f.data(this,"masonry");if(f.isFunction(j.ghoster[i])){j.ghoster[i].apply(j,h)}else{throw"Bad Ghost method."}})}return this};f.fn.masonry=function(i){if(typeof i==="string"){var h=Array.prototype.slice.call(arguments,1);this.each(function(){var j=f.data(this,"masonry");if(!j){c("cannot call methods on masonry prior to initialization; attempted to call method '"+i+"'");return}if(!f.isFunction(j[i])||i.charAt(0)==="_"){c("no such method '"+i+"' for masonry instance");return}j[i].apply(j,h)})}else{this.each(function(){var j=f.data(this,"masonry");if(j){j.option(i||{});j._init()}else{f.data(this,"masonry",new f.Mason(i,this))}})}return this}})(window,jQuery);
(typeof Tumblr!=="undefined")||(Tumblr={});
(function(c,a){var b=new (Backbone.View.extend({id:"glass_overlay",events:{click:"click"},locked:false,initialize:function(){},render:function(){c(document.body).prepend(this.$el);this.rendered=true;c(document).on("keydown",_.bind(this.keydown,this))},click:function(){if(this.locked){return}this.hide()},keydown:function(d){if(this.locked){return}if(this.visible){if(d.keyCode==27){this.hide()}}},show:function(e,d){if(Tumblr.KeyCommands&&!Tumblr.KeyCommands.suspended){Tumblr.KeyCommands.suspend();this.glass_suspended_keys=true}if(!this.rendered){this.render()}d=d||"";this.on_close=e||function(){};this.visible=true;this.$el.addClass("show");setTimeout(_.bind(function(){this.$el.addClass(d)},this),0)},hide:function(){this.visible=false;this.$el.removeClass("show");this.on_close();if(this.glass_suspended_keys){Tumblr.KeyCommands.resume();this.glass_suspended_keys=false}},lock:function(){this.locked=true},unlock:function(){this.locked=false}}))();a.Glass=b})(jQuery,Tumblr);
(function(d,b){var a=Backbone.View.extend({events:{click:"click"},initialize:function(e){this.button=d(e.el||this.$el);this.popover=e.popover||this.$el.find(".popover");this.on_hide=e.on_hide||function(){};this.on_show=e.on_show||function(){};this.auto_show=e.auto_show||false;if(this.auto_show){this.show()}a.register(this)},click:function(){this.toggle()},is_showing:false,show:function(){var e=this;Tumblr.Glass.show(function(){this.hide();this.on_hide()}.bind(this));this.popover.show();this.on_show();this.is_showing=true},hide:function(){var e=this;Tumblr.Glass.on_close=function(){if(e.is_showing){e.popover.hide()}};Tumblr.Glass.hide();this.is_showing=false},toggle:function(){return this.is_showing?this.hide():this.show()},});a.instances=[];a.register=function(e){this.instances.push(e)};a.hide_all=function(){for(var e=0;e<this.instances.length;e++){this.instances[e].hide()}};a.hide_all_after=function(e){e=(e)?e:100;setTimeout(function(){for(var f=0;f<this.instances.length;f++){this.instances[f].hide()}}.bind(this),e)};var c=a.extend({initialize:function(e){Tumblr.BasePopover.prototype.initialize.apply(this,arguments);this.skip_glass=e.skip_glass||false;this.skip_offset=e.skip_offset||false;this.direction=e.direction||"down";this.align=e.align||"left";this.options=e||{};this.options.left=e.left||0;this.options.right=e.right||0;this.options.top=e.top||0;this.options.bottom=e.bottom||0},click:function(){if(!this.options.disable_auto_show){this.show()}return},show:function(){if(this.options.directional){this.position()}var e=this;if(!this.skip_glass){Tumblr.Glass.show(function(){e.hide();e.on_hide()})}if(!this.$el.is(this.popover.parent())){var g={top:0,left:0};var f={};if(!this.skip_offset){g=this.button.position()}if(this.direction!=="up"){f.top=(this.options.top+g.top)+"px"}else{f.bottom=(this.options.bottom-g.top-this.button.height())+"px"}if(this.align!=="right"){f.left=(this.options.left+g.left)+"px"}else{f.right=(this.options.right-g.left-this.button.width())+"px"}this.popover.css(f)}this.popover.show();this.on_show();this.is_showing=true},hide:function(){var e=this;if(!this.skip_glass){Tumblr.Glass.on_close=function(){if(e.is_showing){e.popover.hide()}};Tumblr.Glass.hide()}this.is_showing=false},position:function(){this.popover.show();var i=d(window);var e={top:i.scrollTop(),left:i.scrollLeft()};this.popover.removeClass("up nipple_on_bottom");e.right=e.left+i.width();e.bottom=e.top+i.height();var h=this.popover.offset();var g=this.popover.outerHeight();var f=i.height();h.right=h.left+this.popover.outerWidth();h.bottom=h.top+g;if(f>g&&e.bottom<h.bottom){this.popover.addClass("up nipple_on_bottom")}}});b.BasePopover=a;b.Popover=c})(jQuery,Tumblr);
(function(b,a){var c={zIndex:2000000000,color:"auto",top:"auto",left:"auto",position:"relative",className:"leviathan"};function d(e){if(!this.start){return new d(e)}this.created=false;this.opts=this.opts||{};_.extend(this.opts,d.defaults,c,e)}d.defaults={};d.prototype={start:function(e){if(typeof e!=="object"){e=false}if(e&&e instanceof jQuery){e=e[0]}if(!this.created&&!e){return false}if(!e){e=this.$target[0]}this.destroy();this.uid=this._uid();this.$target=b(e);this.$target.data("loader-uid",this.uid);this.el=this._html();this.$target.append(this.el);this.$loader=b("#loader_"+this.uid);this._init();return this},stop:function(){if(typeof this.$loader!=="undefined"){this.$loader.hide();this.$loader.removeClass("animate")}return this},destroy:function(){this.stop();if(typeof this.$loader!=="undefined"){this.$loader.remove()}if(typeof this.$target!=="undefined"){this.$target.removeData("loader-uid")}return this},center:function(){if(!this.created){return false}var f=this.$target.width();var e=this.$target.height();var h=this.$loader.width();var g=this.$loader.height();var j=(f/2)-(h/2);var i=(e/2)-(g/2);this.$loader.css({left:((this.opts.left==="auto")?j:this.opts.left),top:((this.opts.top==="auto")?i:this.opts.top)});return this},_clear_timeouts:function(){clearTimeout(this.t1);clearTimeout(this.t2);clearTimeout(this.t3)},_init:function(){this.created=true;if(this.opts.color!=="auto"){b(".Knight-Rider-bar",this.$loader).css("background-color",this.opts.color)}this.$loader.css("position",this.opts.position);this.$loader.css("z-index",this.opts.zIndex);this.center();this.$loader.show()},_uid:function(){return Math.floor(Math.random()*10000000)},_html:function(){return'<div id="loader_'+this.uid+'" class="Knight-Rider-loader centered animate '+this.opts.className+'"><div class="Knight-Rider-bar"></div><div class="Knight-Rider-bar"></div><div class="Knight-Rider-bar"></div></div>'}};a.Loader=d})(jQuery,Tumblr);
var Tumblr=Tumblr||{};(function(b,a){var c=Backbone.View.extend({el:"body",events:{"click #jump_to_month":"onMonthSelectorClick","click .year_navigation a":"onYearNavigationClick"},initialize:function(d){this.loading=true;this.current_month=0;this.month_selector_label="Month";this.loaded_url="";this.columnWidth=150;this.gutterWidth=10;this.loader=new Tumblr.Loader({color:"#D9D9D9",position:"absolute",top:"100%"});this.container=b("#content");this.month_selector=b("#jump_to_month .month");this.months_popover=new Tumblr.Popover({el:b("#jump_to_month"),popover:b("#browse_months_widget"),left:-85,top:40});b(window).one("load",_.bind(this.onFirstWindowLoad,this));b(window).on("load",_.bind(this.onWindowLoad,this));b(window).on("ghostscroll",_.bind(this.onWindowScroll,this));b(window).on("ghostbeforeresize",_.bind(this.onWindowResize,this));b(window).on("ghostafterresize",_.bind(this.onAfterResize,this));(function(){var h=b(window);var g=b("#content");var e="no-pointer-events";function f(){var j;var m;function i(){j=Math.floor(Math.random()*Math.pow(10,6));g.addClass(e);setTimeout(l,60);h.one("scroll",k);h.on("scroll."+j,_.debounce(n,80))}function n(){m=false;g.removeClass(e);h.off("scroll."+j);f()}function k(){m=true}function l(){if(!m){n()}}h.one("scroll",i)}h.load(function(){setTimeout(f,2000)})})();this.loader.start(this.container);this.__cache={cols:0,containerHeight:b(this.container).height(),windowHeight:b(window).height(),heading:[],currentMonth:""}},loadPosts:function(){if(b("a#next_page_link").length<1||b("a#next_page_link").attr("href")===this.loaded_url){return}this.loading=true;this.loader.start(this.container);this.loaded_url=b("a#next_page_link").attr("href");b.ajax({url:this.loaded_url,type:"GET",success:_.bind(function(f){var d=b(b.trim(f));var h=d.filter("#content"),g=d.filter("#pagination"),e=d.filter("script:contains(impixu)");(new Function(e.text()))();b("#pagination").html(g.html());this.addPosts(h)},this),error:function(){Tumblr.Dialog.alert("Sorry, something went wrong.")}})},addPosts:function(e){var d=[];b(e).children().each(b.proxy(function(g,h){var l=h.id;b(h).children(".post").each(function(){d.push(this.getAttribute("data-id"))});if(l&&this.container.find("#"+l).length>0){var f=b(h).children();b("#"+l).append(f).masonry("appended",f)}else{var j=b.trim(b(".date",h).text());var k=_.find(this.__cache.heading,function(i){return i.month===j});if(k){return}this.container.append(b(h));this.__cache.heading.push({top:b(h).offset().top-120,month:b(h).text()});_.sortBy(this.__cache.heading,function(i){return i.top})}},this));this.updateLikeButtons(d);this.onWindowLoad()},updateLikeButtons:function(d){},updateLayout:function(){b(".posts:not(.masonry)").masonry({itemSelector:".post",gutterWidth:this.gutterWidth,columnWidth:this.columnWidth,ghoster:{}})},onAfterResize:function(d){this.__cache.windowHeight=b(window).height();this.__cache.containerHeight=b(this.container).outerHeight(true)},resizeContainer:function(f){var d=this.columnWidth+this.gutterWidth;var e=this.container.parent().width();var g=Math.floor(e/d);if(this.__cache.cols!==g){this.container.width(g*d)}},onMonthSelectorClick:function(d){d.preventDefault();this.months_popover.show()},onYearNavigationClick:function(g){g.preventDefault();var f=b(g.currentTarget),d=f.closest(".year");if(f.hasClass("next_year")&&d.prev().length>0){d.hide();d.prev().show()}else{if(f.hasClass("previous_year")&&d.next().length>0){d.hide();d.next().show()}}},onBackToTopClick:function(d){d.preventDefault();b("body,html").animate({scrollTop:0},200,this.onWindowScroll.bind(this))},onFirstWindowLoad:function(d){this.container.children("section, header").show()},onWindowLoad:function(){this.loading=false;this.loader.stop();b(".loading").removeClass("loading");this.resizeContainer();this.updateLayout();var d=b("header.heading .date");this.__cache.heading=this.__cache.heading.concat(_.map(d,function(f){var e=b(f);return{top:e.offset().top-120,month:e.text()}}));_.sortBy(this.__cache.heading,function(e){return e.top});this.__cache.containerHeight=b(this.container).outerHeight(true);this.__cache.windowHeight=b(window).height();if(this.__cache.containerHeight<this.__cache.windowHeight){this.loadPosts()}},onWindowResize:function(f,d){this.resizeContainer(d)},onWindowScroll:function(j,f){var h=f.scrollTop||0;var l=f.windowHeight||0;var g=this.__cache.containerHeight;var k=(g-l*2);for(var d=this.__cache.heading.length-1;d>=0;d--){if(h>this.__cache.heading[d].top){if(this.__cache.currentMonth==this.__cache.heading[d].month){}else{this.__cache.currentMonth=this.__cache.heading[d].month;this.month_selector.text(this.__cache.currentMonth)}break}}if(!this.loading){if(h>=k){this.loadPosts()}}}});b(function(){new c()})})(jQuery,Tumblr);
